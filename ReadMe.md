# Соглашение об именовании в базе данных Omnibus
## Введение

На момент написания соглашения процесс именования идентификаторов реляционной БД не определён однозначно. Это связано с тем, что не существует ни официального набора рекомендаций по именованию от разработчиков СУБД PostgreSQL, ни исследований, однозначно определяющих лучшие практики. Все найденные в ходе изучения проблемы рекомендации основываются на личном опыте авторов и сходятся лишь в необходимости использования единой нотации в рамках БД.

Данное соглашение составлялось исходя из нижеприведённых соображений. Необходимо обеспечить лаконичность написания SQL-запросов к БД вручную, сохранить читаемость имён при изучении структуры БД, унифицировать и формализовать процесс именования идентификаторов.

----------

## Стили написания

В нотации применяются два стиля написания составных слов:

* CamelCase - несколько слов пишутся слитно без пробелов, каждое слово пишется с прописной буквы;
* lower_case - несколько слов разделяются нижним подчеркиванием, все буквы - строчные.

Преимущество lower_case в именованиях идентификаторов заключается в том, что при обращении к этим элементам не нужно ставить кавычки, а к недостаткам можно отнести увеличение размера имени идентификатора, состоящего из множества слов.
В описываемой нотации эти стили применяются как по отдельности, так и в комбинации.

----------

## Именование схем

Схемы именуются с использованием CamelCase, имя характеризует соответствующую предметную область. Допускается использование сокращений. 

Примеры:
	
	CREATE SCHEMA "Admin";
	CREATE SCHEMA "GeoProjects";
	CREATE SCHEMA "GeoTherm";

Для каждой схемы необходимо сформировать уникальный префикс, который затем будет использоваться для идентификаторов, относящихся к этой схеме. Префикс именуется с использованием lower_case и состоит из двух-трёх букв. Префикс указывается в комментарии схемы.

Примеры:

* adm
* gp
* gt

---------

## Именование таблиц

Таблицы именуются с использованием CamelCase, имя характеризует соответствующую сущность предметной области. Имя таблицы используется в единственном числе. К имени добавляется префикс, обозначающий тип таблицы в ходе проектирования. 

Существующие префиксы типов таблиц:

1. T - обычная таблица, в ходе проектирования характеризующая какую-либо сущность предметной области;
2. J - таблица связи, полученная в результате связи "много-ко-многим" двух других таблиц. Имена таких таблиц образуются слиянием имён связуемых таблиц (без префиксов);
3. V - представление;
4. I - ???;
5. H - темпоральная таблица. Предполагается, что для темпоральной таблицы xxHName существует таблица с актуальными значениями xxTName, и все колонки темпоральной таблицы соответствуют таковым исходной. В темпоральных таблицах отсутствуют ограничения, в том числе первичные ключи.

Затем к получившемуся имени таблицы добавляется префикс схемы, в которой содержится эта таблица. Это обеспечивает уникальность названий таблиц. Вкупе с добавлением всех схем БД в переменную окружения search_path становится возможным обращения к таблицам без указания схем.

Примеры:

	CREATE TABLE "GeoTherm"."gtTAreal";
	CREATE TABLE "GeoProjects"."gpJProjectUser";

----------

## Именование колонок

Колонки именуются с использованием CamelCase, имя характеризует соответствующий атрибут сущности предметной области.

### Первичные ключи

Как правило, в качестве первичных ключей таблиц используются суррогатные ключи. Этот подход имеет ряд преимуществ: индексы становятся короче, решается проблема с сущностями без явно выделенных потенциальных ключей. Эти суррогатные ключи имеют общепринятое имя Id.

Для обеспечения лаконичности написанных вручную SQL-запросов два наиболее часто встречающихся в сущностях атрибута (Id и название\имя сущности) именуются уникально для всех таблиц. Для этого к Id добавляется постфикс: название таблицы, а атрибут "имя" именуется так же, как название таблицы.

### Внешние ключи

Внешние ключи именуются так же, как и первичные ключи, на которые они ссылаются, однако между префиксом Id и названием таблицы добавляется нижнее подчеркивание. Если одна таблица имеет несколько внешних ключей, ссылающихся на другую таблицу, к этим внешним ключам добавляются дополнительные семантические суффиксы.

Примеры:

	...
	IdCity serial NOT NULL,
	City text NOT NULL,
	Location "GeoProjects".geometry(Point, 28414)
	...
	IdProject serial NOT NULL,
	Project text NOT NULL,
	StartDate date,
	EndDate date
	...
	IdMap serial NOT NULL,
	Id_Project integer NOT NULL
	...	
	"IdSample" integer NOT NULL,
	"Region" text,
    "Field" text,
	"Id_EmployeeGiver" integer NOT NULL,
	"Id_EmployeeTaker" integer NOT NULL
	...

---------

## Именование ограничений

Ограничения именуются стандартно (как если бы они именовались в PostgreSQL автоматически) с использованием lower_case и, где необходимо, CamelCase.

Имена первичных ключей состоят из названия таблицы со всеми префиксами и постфиксом _pkey.

Примеры:

	...
	ADD CONSTRAINT "gpJProjectEmployee_pkey" PRIMARY KEY
	...
	CONSTRAINT "chTGraduation_pkey" PRIMARY KEY
	...

Имена внешних ключей состоят из названия таблицы, имён колонки или колонок, включенных во внеший ключ, а также постфикса _fkey.

Примеры:

	...
	ADD CONSTRAINT "chTGraduation_Id_WorkingJournal_fkey" FOREIGN KEY
	...
	ADD CONSTRAINT "gpJProjectEmployee_Id_Employee_fkey" FOREIGN KEY
	...

Имена ограничений уникальности состоят из названия таблицы, имён колонки или колонок, включенных в ограничение, а также постфикса _key.

Примеры:

	...
	ADD CONSTRAINT "gpTProject_Project_key" UNIQUE
	...

Имена проверок состоят из названия таблицы, имени проверки, а также постфикса _check.

Примеры:

	...
	ADD CONSTRAINT "gpTProject_dates_check" CHECK
	...

----------

## Именование пользовательских типов

Пользовательские типы именуются с использованием CamelCase, к ним добавляется префикс соответствующей схемы, а также один из перечисленных ниже префиксов:

1. E - для перечисляемых типов (типов перечислений);
2. C - для составных типов.

Примеры:

	CREATE TYPE "Chemistry"."chEColumnType" AS ENUM
    	('Parameter', 'Result', 'CalculatedValue');
	CREATE TYPE "Chemistry"."chEColumnType" AS ENUM
    	('Parameter', 'Result', 'CalculatedValue');

----------

## Именование ролей

Все роли именуются с использованием CamelCase, но к групповым ролям, относящимся к определённой схеме, прибавляется префикс схемы.
Пользовательские роли формируются из транслитерированной полной фамилии и инициалов имени и отчества соответствующего сотрудника.

Примеры:

	CREATE ROLE "BaseRole" WITH NOLOGIN;
	CREATE ROLE "Admin" WITH NOLOGIN;
	CREATE ROLE "gpBaseRole" WITH NOLOGIN;
	GRANT "BaseRole" TO "gpBaseRole";
	CREATE ROLE "PogartsevKM" WITH LOGIN;
	GRANT "Admin", "gpBaseRole" TO "PogartsevKM";
